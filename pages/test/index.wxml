<!--pages/test/index.wxml-->
<view class="test-container">
  <!-- æµ‹è¯•è¿›è¡Œä¸­ -->
  <block wx:if="{{!showResult}}">
    <view class="test-header">
      <text class="test-title">å•è¯ç»ƒä¹ </text>
      <text class="test-subtitle">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</text>
    </view>

    <!-- é¢˜å‹é€‰æ‹© -->
    <view class="type-selector">
      <view class="type-btn {{testType === 'choice' ? 'active' : ''}}" bindtap="switchType" data-type="choice">
        <view class="type-icon">ğŸ“</view>
        <view class="type-name">é€‰æ‹©é¢˜</view>
      </view>
      <view class="type-btn {{testType === 'spell' ? 'active' : ''}}" bindtap="switchType" data-type="spell">
        <view class="type-icon">âœï¸</view>
        <view class="type-name">å¡«ç©ºé¢˜</view>
      </view>
      <view class="type-btn {{testType === 'listen' ? 'active' : ''}}" bindtap="switchType" data-type="listen">
        <view class="type-icon">ğŸ§</view>
        <view class="type-name">å¬åŠ›é¢˜</view>
      </view>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-section">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentIndex + 1) / questions.length * 100}}%"></view>
      </view>
      <view class="progress-info">
        <text>ç¬¬ {{currentIndex + 1}} / {{questions.length}} é¢˜</text>
        <text class="timer">{{timer}}s</text>
      </view>
    </view>

    <!-- é¢˜ç›®å¡ç‰‡ -->
    <view class="question-card">
      <!-- é€‰æ‹©é¢˜/å¬åŠ›é¢˜æ˜¾ç¤ºå•è¯ -->
      <block wx:if="{{testType !== 'spell'}}">
        <view class="question-word">{{currentQuestion.word}}</view>
        <view class="question-phonetic" bindtap="playSound">{{currentQuestion.phonetic}} ğŸ”Š</view>
      </block>
      
      <!-- å¡«ç©ºé¢˜æ˜¾ç¤ºä¸­æ–‡ -->
      <block wx:else>
        <view class="question-word" style="font-size: 48rpx;">{{currentQuestion.meaning}}</view>
        <view class="question-phonetic">è¯·è¾“å…¥å¯¹åº”çš„è‹±æ–‡å•è¯</view>
      </block>

      <!-- é€‰æ‹©é¢˜é€‰é¡¹ -->
      <view class="options-list" wx:if="{{testType !== 'spell'}}">
        <view 
          wx:for="{{currentOptions}}" 
          wx:key="index"
          class="option-item {{answered ? (item === currentQuestion.meaning ? 'correct' : (selectedOption === item ? 'wrong' : '')) : ''}}"
          bindtap="selectOption"
          data-option="{{item}}"
        >
          {{item}}
        </view>
      </view>

      <!-- å¡«ç©ºé¢˜è¾“å…¥ -->
      <view class="input-section" wx:if="{{testType === 'spell'}}">
        <input 
          class="word-input" 
          placeholder="è¾“å…¥è‹±æ–‡å•è¯"
          value="{{inputAnswer}}"
          bindinput="onInput"
          bindconfirm="submitSpell"
        />
        <button class="btn btn-primary submit-btn" bindtap="submitSpell">æäº¤ç­”æ¡ˆ</button>
      </view>
    </view>
  </block>

  <!-- ç»“æœé¡µé¢ -->
  <block wx:else>
    <view class="result-container animate-slideUp">
      <view class="result-icon">{{correctCount >= questions.length * 0.8 ? 'ğŸ‰' : (correctCount >= questions.length * 0.5 ? 'ğŸ‘' : 'ğŸ’ª')}}</view>
      <view class="result-score">{{Math.round(correctCount / questions.length * 100)}}%</view>
      <view class="result-label">æ­£ç¡®ç‡</view>
      
      <view class="result-stats">
        <view class="stat-item">
          <view class="stat-value text-success">{{correctCount}}</view>
          <view class="stat-label">æ­£ç¡®</view>
        </view>
        <view class="stat-item">
          <view class="stat-value text-error">{{questions.length - correctCount}}</view>
          <view class="stat-label">é”™è¯¯</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{totalTime}}s</view>
          <view class="stat-label">ç”¨æ—¶</view>
        </view>
      </view>

      <view class="result-actions">
        <button class="btn btn-outline" bindtap="goHome">è¿”å›é¦–é¡µ</button>
        <button class="btn btn-primary" bindtap="restart">å†æ¥ä¸€æ¬¡</button>
      </view>
    </view>
  </block>
</view>
